<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Egito NCRP - Gest√£o Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --gold: #fbbf24;
            --gold-dark: #b45309;
            --glass: rgba(15, 15, 15, 0.9);
            --gif-url: url('https://i.postimg.cc/qBjFc713/cards.gif');
        }

        /* CURSOR PERSONALIZADO (BALA DE FUZIL) */
        body, button, a, .gold-card, input, select {
            cursor: url('https://cdn-icons-png.flaticon.com/32/3024/3024312.png'), auto !important;
        }

        body {
            background: radial-gradient(circle at center, #1a1a1a 0%, #000 100%);
            color: #e5e7eb;
            font-family: 'Rajdhani', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* EFEITO DE BALAS FLUTUANDO AO FUNDO */
        .bullet-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .floating-bullet {
            position: absolute;
            width: 4px;
            height: 15px;
            background: linear-gradient(to bottom, #ffd700, #b45309);
            border-radius: 2px;
            opacity: 0.3;
            animation: fall linear infinite;
        }

        @keyframes fall {
            from { transform: translateY(-100px) rotate(45deg); }
            to { transform: translateY(110vh) rotate(45deg); }
        }

        /* EFEITO DE IMPACTO AO CLICAR */
        .click-spark {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--gold);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            animation: spark-anim 0.6s ease-out forwards;
        }

        @keyframes spark-anim {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(4); opacity: 0; box-shadow: 0 0 20px var(--gold); }
        }

        .bg-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--gif-url) center/cover no-repeat;
            opacity: 0.1;
            z-index: -1;
            filter: grayscale(100%);
        }

        .gold-card {
            background: var(--glass);
            border: 1px solid rgba(251, 191, 36, 0.3);
            backdrop-filter: blur(12px);
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .card-with-gif::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--gif-url) center/cover;
            opacity: 0.05;
            transition: opacity 0.4s;
            z-index: 0;
            pointer-events: none;
        }

        .gold-card:hover::before { opacity: 0.15; }
        .gold-card:hover {
            border-color: var(--gold);
            transform: translateY(-5px);
            box-shadow: 0 0 25px rgba(251, 191, 36, 0.15);
        }

        .card-content { position: relative; z-index: 1; }

        .btn-gold {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
            color: black;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: 0.3s;
        }

        .btn-gold:hover {
            filter: brightness(1.2);
            box-shadow: 0 0 15px var(--gold);
        }

        input, select {
            background: rgba(0,0,0,0.6) !important;
            border: 1px solid rgba(251, 191, 36, 0.2) !important;
            color: white !important;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-view { animation: slideUp 0.4s ease-out forwards; }
        .orbitron { font-family: 'Orbitron', sans-serif; }

        .status-glow {
            width: 8px; height: 8px;
            background: #22c55e;
            border-radius: 50%;
            box-shadow: 0 0 10px #22c55e;
            display: inline-block;
        }
    </style>
</head>
<body onload="inicializarSistema()">
    <div class="bg-overlay"></div>
    <div class="bullet-bg" id="bullet-container"></div>

    <header id="main-header" class="hidden flex flex-col md:flex-row justify-between items-center mb-8 bg-black/80 p-6 border-b border-yellow-500/30 backdrop-blur-lg z-50">
        <div class="text-center md:text-left">
            <h1 class="text-3xl font-bold text-yellow-500 orbitron tracking-tighter">EG EGITO <span class="text-white">NCRP</span></h1>
            <div class="flex items-center gap-2 justify-center md:justify-start">
                <span class="status-glow"></span>
                <p id="user-welcome" class="text-xs text-gray-400 uppercase tracking-widest"></p>
            </div>
        </div>
        <button onclick="logout()" class="mt-4 md:mt-0 border border-red-500/50 text-red-500 hover:bg-red-500 hover:text-white px-8 py-2 rounded-full text-xs font-bold transition-all">LOGOUT</button>
    </header>

    <main id="view-login" class="max-w-md mx-auto mt-20 p-4 relative z-10">
        <div class="gold-card card-with-gif rounded-2xl p-8 border-t-4 border-t-yellow-500">
            <div class="card-content">
                <div class="text-center mb-8">
                    <div class="text-5xl mb-4">üá™üá¨</div>
                    <h2 class="text-2xl font-bold text-yellow-500 orbitron">ACESSO RESTRITO</h2>
                    <p class="text-gray-500 text-[10px] tracking-[0.3em]">SECURE ENCRYPTED TERMINAL</p>
                </div>
                <div class="space-y-4">
                    <input type="text" id="login-nick" placeholder="NICK NAME" class="w-full p-4 rounded-xl focus:outline-none focus:border-yellow-500">
                    <input type="number" id="login-pass" placeholder="ID PASSAPORTE" class="w-full p-4 rounded-xl focus:outline-none focus:border-yellow-500">
                    <select id="login-perfil" class="w-full p-4 rounded-xl">
                        <option value="Respons√°vel">RESPONS√ÅVEL</option>
                        <option value="Auxiliar">AUXILIAR</option>
                        <option value="Farme">RESP. FARME</option>
                        <option value="Planilha">Planilha</option>
                    </select>
                    <button onclick="login()" class="w-full btn-gold py-4 rounded-xl text-lg shadow-xl">REALIZAR LOGIN</button>
                </div>
            </div>
        </div>
    </main>

    <main id="view-dashboard" class="hidden max-w-7xl mx-auto px-4 animate-view relative z-10">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6 mb-12">
            <div onclick="showView('cadastro')" class="gold-card card-with-gif rounded-2xl p-6 cursor-pointer group">
                <div class="card-content">
                    <h3 class="text-yellow-500 font-bold orbitron text-xs mb-1">CADASTRAR MEMBRO</h3>
                    <p class="text-2xl font-bold text-white mb-2">Novo Membro</p>
                    <span class="text-[9px] text-gray-400 border border-white/10 px-2 py-1 rounded">CADASTRAR MEMBRO</span>
                </div>
            </div>
            <div onclick="showView('historico')" class="gold-card card-with-gif rounded-2xl p-6 cursor-pointer group">
                <div class="card-content">
                    <h3 class="text-yellow-500 font-bold orbitron text-xs mb-1">HISTORICO COMPROVANTES</h3>
                    <p class="text-2xl font-bold text-white mb-2">COMPROVANTES</p>
                    <span class="text-[9px] text-gray-400 border border-white/10 px-2 py-1 rounded">TROPA DO EGITO</span>
                </div>
            </div>
            <div onclick="showView('config')" class="gold-card card-with-gif rounded-2xl p-6 cursor-pointer group">
                <div class="card-content">
                    <h3 class="text-yellow-500 font-bold orbitron text-xs mb-1">CONFIG DISCORD</h3>
                    <p class="text-2xl font-bold text-white mb-2">Webhooks</p>
                    <span class="text-[9px] text-gray-400 border border-white/10 px-2 py-1 rounded">CONFIG DISCORD</span>
                </div>
            </div>
            <div onclick="showView('planilha')" class="gold-card card-with-gif rounded-2xl p-6 cursor-pointer">
                <div class="card-content">
                    <h3 class="text-yellow-500 font-bold orbitron text-xs mb-1">LISTA DE APROADOS</h3>
                    <p id="count-membros" class="text-2xl font-bold text-white mb-2">0 Membros</p>
                    <span class="text-[9px] text-yellow-500 animate-pulse font-bold">ABRIR LISTA DE APROVADOS</span>
                </div>
            </div>
            <div onclick="abrirConfigAdmin()" class="gold-card card-with-gif rounded-2xl p-6 cursor-pointer border-red-500/30 bg-red-500/5">
                <div class="card-content">
                    <h3 class="text-red-500 font-bold orbitron text-xs mb-1">√ÅREA PRIVADA</h3>
                    <p class="text-2xl font-bold text-white mb-2">CONFIG.ADM</p>
                    <span class="text-[9px] text-red-500 font-bold">ACESSO RESTRITO üîí</span>
                </div>
            </div>
        </div>
        
        <div class="gold-card rounded-3xl p-8 mb-10 border-t-4 border-t-green-500">
            <h2 class="text-xl font-bold text-white orbitron mb-8 flex items-center gap-4">
                <span class="w-12 h-[2px] bg-green-500"></span> FINANCEIRO RECRUTAMENTO (FAC)
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-8">
                <div class="bg-black/60 p-6 rounded-2xl border border-white/5">
                    <div class="text-[10px] text-gray-500 font-bold mb-1 uppercase">Total Dinheiro Limpo</div>
                    <div id="total-limpo" class="text-4xl font-bold text-green-500 orbitron">R$ 0,00</div>
                </div>
                <div class="bg-black/60 p-6 rounded-2xl border border-white/5">
                    <div class="text-[10px] text-gray-500 font-bold mb-1 uppercase">Total Dinheiro Sujo</div>
                    <div id="total-sujo" class="text-4xl font-bold text-red-500 orbitron">R$ 0,00</div>
                </div>
            </div>
        </div>

        <div class="gold-card rounded-3xl p-8 mb-10">
            <h2 class="text-xl font-bold text-white orbitron mb-8 flex items-center gap-4">
                <span class="w-12 h-[2px] bg-yellow-500"></span> ANALYTICS EGITO
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-8" id="stats-container"></div>
        </div>
    </main>

    <main id="view-admin" class="hidden max-w-7xl mx-auto px-4 animate-view relative z-10">
        <div class="flex justify-between items-center mb-6">
            <button onclick="showView('dashboard')" class="text-yellow-500 font-bold text-xs uppercase">‚Üê Voltar ao Terminal</button>
            <h2 class="text-xl font-bold text-red-500 orbitron">PAINEL ADMINISTRATIVO</h2>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
            <div class="gold-card p-6 rounded-2xl border-l-4 border-l-green-500">
                <h3 class="text-white font-bold mb-4 orbitron text-sm">AJUSTAR FINANCEIRO LIMPO</h3>
                <div class="flex gap-4">
                    <input type="number" id="edit-limpo" placeholder="Novo valor Total Limpo" class="w-full p-4 rounded-xl">
                    <button onclick="salvarFinanceiroManual('limpo')" class="btn-gold px-6 rounded-xl">SALVAR</button>
                </div>
            </div>
            <div class="gold-card p-6 rounded-2xl border-l-4 border-l-red-500">
                <h3 class="text-white font-bold mb-4 orbitron text-sm">AJUSTAR FINANCEIRO SUJO</h3>
                <div class="flex gap-4">
                    <input type="number" id="edit-sujo" placeholder="Novo valor Total Sujo" class="w-full p-4 rounded-xl">
                    <button onclick="salvarFinanceiroManual('sujo')" class="btn-gold px-6 rounded-xl">SALVAR</button>
                </div>
            </div>
        </div>

        <div class="gold-card rounded-2xl overflow-hidden shadow-2xl">
            <div class="bg-red-500 text-white p-4 font-bold orbitron text-center text-xs tracking-widest uppercase">Gerenciamento de Membros & Planilha</div>
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm">
                    <thead class="bg-black/80 text-yellow-500 orbitron text-[10px]">
                        <tr>
                            <th class="p-5">NICK</th>
                            <th class="p-5">PASSAPORTE</th>
                            <th class="p-5">CARGO</th>
                            <th class="p-5">QUEM RECRUTOU</th>
                            <th class="p-5 text-center">A√á√ÉO</th>
                        </tr>
                    </thead>
                    <tbody id="corpo-tabela-admin" class="divide-y divide-white/5"></tbody>
                </table>
            </div>
        </div>
    </main>

    <main id="view-cadastro" class="hidden max-w-2xl mx-auto px-4 animate-view relative z-10">
        <button onclick="showView('dashboard')" class="text-yellow-500 mb-6 flex items-center gap-2 text-xs font-bold uppercase tracking-widest">
            ‚Üê Voltar ao Terminal
        </button>
        <div class="gold-card p-8 rounded-2xl border-l-4 border-l-yellow-500">
            <form id="form-recrutamento" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="text-[10px] text-gray-400 uppercase tracking-widest">Nome do Recruta</label>
                        <input type="text" id="rec-nick" placeholder="Nome_Sobrenome" required class="w-full p-4 rounded-xl">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] text-gray-400 uppercase tracking-widest">ID Passaporte</label>
                        <input type="number" id="rec-pass" placeholder="0000" required class="w-full p-4 rounded-xl">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="text-[10px] text-gray-400 uppercase tracking-widest">Nome do Recrutador</label>
                        <input type="text" id="rec-recrutador" placeholder="Nick do Recrutador" required class="w-full p-4 rounded-xl">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] text-gray-400 uppercase tracking-widest">Data do Recrutamento</label>
                        <input type="date" id="rec-data-manual" required class="w-full p-4 rounded-xl text-white">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-yellow-500/5 rounded-xl border border-yellow-500/10">
                    <div class="space-y-2">
                        <label class="text-[10px] text-yellow-500 uppercase tracking-widest font-bold">Valor Miss√£o</label>
                        <input type="number" id="rec-valor-total" placeholder="Ex: 1500000" required class="w-full p-4 rounded-xl">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] text-yellow-500 uppercase tracking-widest font-bold">Comiss√£o Recrutador</label>
                        <input type="number" id="rec-valor-recrutador" placeholder="Ex: 400000" required class="w-full p-4 rounded-xl">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] text-yellow-500 uppercase tracking-widest font-bold">Tipo</label>
                        <select id="rec-tipo-dinheiro" class="w-full p-4 rounded-xl">
                            <option value="limpo">DINHEIRO LIMPO</option>
                            <option value="sujo">DINHEIRO SUJO</option>
                        </select>
                    </div>
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] text-gray-400 uppercase tracking-widest">Patente</label>
                    <select id="rec-cargo" class="w-full p-4 rounded-xl">
                        <option value="„Äå·¥Ñ Ä…™·¥Ä„Äç">„Äå·¥Ñ Ä…™·¥Ä„Äç</option>
                        <option value="„Äåequipe farme„Äç">„Äåequipe farme„Äç</option>
                        <option value=" [Olheiro] ">[Olheiro] </option>
                        <option value=" [Avi√£ozinho] ">[Avi√£ozinho] </option>
                        <option value="„ÄåFogueteiro„Äç">„ÄåFogueteiro„Äç</option>
                        <option value="„ÄåVapor„Äç">„ÄåVapor„Äç</option>
                        <option value="„ÄåTraficante„Äç">„ÄåTraficante„Äç</option>
                        <option value="„ÄåFrente da boca„Äç">„ÄåFrente da boca„Äç </option>
                        <option value="„ÄåFrente„Äç">„ÄåFrente„Äç</option>
                    </select>
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] text-gray-400 uppercase tracking-widest">Link da Imagem (Provas)</label>
                    <input type="url" id="rec-img" required class="w-full p-4 rounded-xl">
                </div>
                <button type="submit" class="w-full btn-gold py-5 rounded-xl text-lg mt-4">REALIZAR CADASTRO</button>
            </form>
        </div>
    </main>

    <main id="view-historico" class="hidden max-w-4xl mx-auto px-4 animate-view relative z-10">
        <button onclick="showView('dashboard')" class="text-yellow-500 mb-6 font-bold text-xs uppercase">‚Üê Painel</button>
        <div class="gold-card p-6 rounded-2xl mb-6 border border-dashed border-yellow-500/50">
            <h3 class="text-yellow-500 orbitron text-xs mb-4">IMPORTAR DATABASE (EXCEL/CSV)</h3>
            <input type="file" id="upload-excel" accept=".xlsx, .xls, .csv" class="hidden" onchange="importarArquivo(this)">
            <label for="upload-excel" class="btn-gold px-6 py-3 rounded-xl text-xs cursor-pointer inline-block">SELECIONAR ARQUIVO</label>
            <p class="text-[9px] text-gray-500 mt-2">Colunas esperadas: Nick, Passaporte, Cargo, Recrutador</p>
        </div>
        <div id="lista-recrutados" class="space-y-4"></div>
    </main>

    <main id="view-planilha" class="hidden max-w-7xl mx-auto px-4 animate-view relative z-10">
        <div class="flex justify-between items-center mb-6">
            <button onclick="showView('dashboard')" class="text-yellow-500 font-bold text-xs uppercase">‚Üê Voltar</button>
            <div class="flex gap-2">
                <button onclick="baixarExcel()" class="bg-green-600/20 text-green-500 border border-green-600 px-4 py-2 rounded text-xs font-bold">EXCEL</button>
                <button onclick="enviarListaDiscord()" class="btn-gold px-6 py-2 rounded text-xs font-bold">ENVIAR/ATUALIZAR LISTA</button>
            </div>
        </div>
        <div class="gold-card rounded-2xl overflow-hidden shadow-2xl">
            <div id="titulo-planilha" class="bg-yellow-500 text-black p-4 font-bold orbitron text-center text-xs"></div>
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm" id="tabela-aprovados">
                    <thead class="bg-black/80 text-yellow-500 orbitron text-[10px]">
                        <tr>
                            <th class="p-5 border-b border-yellow-500/10">MEMBRO</th>
                            <th class="p-5 border-b border-yellow-500/10">PASSAPORTE</th>
                            <th class="p-5 border-b border-yellow-500/10">CARGO</th>
                            <th class="p-5 border-b border-yellow-500/10">RECRUTADOR</th>
                        </tr>
                    </thead>
                    <tbody id="corpo-tabela" class="divide-y divide-white/5"></tbody>
                </table>
            </div>
        </div>
    </main>

    <main id="view-config" class="hidden max-w-2xl mx-auto px-4 animate-view relative z-10">
        <button onclick="showView('dashboard')" class="text-yellow-500 mb-6 font-bold text-xs">‚Üê Voltar</button>
        <div class="gold-card p-8 rounded-2xl">
            <h2 class="text-xl font-bold text-yellow-500 orbitron mb-8 text-center uppercase">Webhooks de Integra√ß√£o</h2>
            <div class="space-y-6">
                <div>
                    <label class="text-[10px] text-gray-500 uppercase font-bold ml-1">Webhook de Provas (GIF/IMG)</label>
                    <input type="text" id="webhook-fotos" class="w-full p-4 rounded-xl mt-2" placeholder="URL do Webhook">
                </div>
                <div>
                    <label class="text-[10px] text-gray-400 uppercase font-bold ml-1">Webhook de Lista Oficial</label>
                    <input type="text" id="webhook-lista" class="w-full p-4 rounded-xl mt-2" placeholder="URL do Webhook">
                </div>
                <button onclick="salvarWebhooks()" class="w-full btn-gold py-4 rounded-xl font-bold mt-4">SALVAR CONFIGURA√á√ïES</button>
            </div>
        </div>
    </main>

    <script>
        const FUNDADOR_NICK = "Dallas Beiramar";
        const FUNDADOR_PASS = "10946";
        const GIF_CARDS = "https://i.postimg.cc/qBjFc713/cards.gif";
        const BANDEIRA_GIF = "https://i.postimg.cc/qBjFc713/cards.gif"; 
        const FIREBASE_URL = "https://egito-ncrp-default-rtdb.firebaseio.com/membros.json";
        const FIREBASE_FINANCE_URL = "https://egito-ncrp-default-rtdb.firebaseio.com/financeiro.json";
        const FIREBASE_MSG_URL = "https://egito-ncrp-default-rtdb.firebaseio.com/config/last_msg_id.json";
        
        let db = [];
        let financeiroGlobal = { limpo: 169436500, sujo: 4400000 };
        let userLogado = null;

        // --- EFEITOS VISUAIS ---
        function createBullets() {
            const container = document.getElementById('bullet-container');
            for(let i = 0; i < 25; i++) {
                let bullet = document.createElement('div');
                bullet.className = 'floating-bullet';
                bullet.style.left = Math.random() * 100 + 'vw';
                bullet.style.animationDuration = (Math.random() * 3 + 2) + 's';
                bullet.style.animationDelay = Math.random() * 5 + 's';
                container.appendChild(bullet);
            }
        }

        window.addEventListener('click', (e) => {
            let spark = document.createElement('div');
            spark.className = 'click-spark';
            spark.style.left = (e.pageX - 5) + 'px';
            spark.style.top = (e.pageY - 5) + 'px';
            document.body.appendChild(spark);
            setTimeout(() => spark.remove(), 600);
        });

        // --- CORE SISTEMA ---
        async function inicializarSistema() {
            createBullets();
            const salvo = JSON.parse(localStorage.getItem('eg_egito_remember'));
            if(salvo) {
                document.getElementById('login-nick').value = salvo.nick;
                document.getElementById('login-pass').value = salvo.pass;
                document.getElementById('login-perfil').value = salvo.perfil;
            }
            document.getElementById('webhook-fotos').value = localStorage.getItem('eg_webhook_fotos') || '';
            document.getElementById('webhook-lista').value = localStorage.getItem('eg_webhook_lista') || '';
            await carregarDadosGlobais();
        }

        async function carregarDadosGlobais() {
            try {
                const response = await fetch(FIREBASE_URL);
                const data = await response.json();
                db = data ? Object.keys(data).map(key => ({...data[key], firebaseId: key})) : [];
                const resFin = await fetch(FIREBASE_FINANCE_URL);
                const dataFin = await resFin.json();
                if(dataFin) financeiroGlobal = dataFin;
                updateStats();
                calcularFinanceiro();
            } catch (e) { console.error("Erro ao carregar banco!"); }
        }

        function login() {
            const nick = document.getElementById('login-nick').value;
            const pass = document.getElementById('login-pass').value;
            const perfil = document.getElementById('login-perfil').value;
            if(!nick || !pass) return alert("Erro: Identifique-se!");
            localStorage.setItem('eg_egito_remember', JSON.stringify({nick, pass, perfil}));
            userLogado = { nick, pass, perfil };
            document.getElementById('user-welcome').innerText = `${nick} // ${perfil}`;
            document.getElementById('main-header').classList.remove('hidden');
            showView('dashboard');
        }

        function abrirConfigAdmin() {
            // LOGIN AUTOM√ÅTICO SE FOR O FUNDADOR
            if (userLogado.nick === FUNDADOR_NICK && userLogado.pass === FUNDADOR_PASS) {
                showView('admin');
            } else {
                const senha = prompt("DIGITE A SENHA DE ADMINISTRADOR:");
                if(senha === "300820") {
                    showView('admin');
                } else {
                    alert("SENHA INCORRETA! ACESSO NEGADO.");
                }
            }
        }

        function showView(viewName) {
            document.querySelectorAll('main').forEach(v => v.classList.add('hidden'));
            const active = document.getElementById(`view-${viewName}`);
            active.classList.remove('hidden');
            active.classList.add('animate-view');
            
            if(viewName === 'dashboard') {
                updateStats();
                calcularFinanceiro();
            }
            if(viewName === 'historico') renderHistorico();
            if(viewName === 'planilha') renderPlanilhaData();
            if(viewName === 'admin') renderAdminData();
            if(viewName === 'cadastro') {
                document.getElementById('rec-data-manual').value = new Date().toISOString().split('T')[0];
                document.getElementById('rec-recrutador').value = userLogado.nick;
            }
        }

        function updateStats() {
            const ativos = db.filter(r => !r.excluido);
            document.getElementById('count-membros').innerText = `${ativos.length} Membros`;
            const stats = [
                { val: ativos.length, lab: 'TOTAL ATIVOS', col: 'text-yellow-500' },
                { val: ativos.filter(r => r.cargo === '„Äå·¥Ñ Ä…™·¥Ä„Äç').length, lab: 'CRIAS', col: 'text-white' },
                { val: ativos.filter(r => r.cargo === '„Äåequipe farme„Äç').length, lab: 'FARME', col: 'text-white/60' }
            ];
            document.getElementById('stats-container').innerHTML = stats.map(s => `
                <div class="bg-black/60 p-6 rounded-2xl border border-white/5">
                    <div class="text-[10px] text-gray-500 font-bold mb-1">${s.lab}</div>
                    <div class="text-4xl font-bold ${s.col} orbitron">${s.val}</div>
                </div>
            `).join('');
        }

        function calcularFinanceiro() {
            let totalLimpo = financeiroGlobal.limpo;
            let totalSujo = financeiroGlobal.sujo;
            db.forEach(m => {
                if(m.valorFac) {
                    if(m.tipoDinheiro === 'limpo') totalLimpo += parseFloat(m.valorFac);
                    else totalSujo += parseFloat(m.valorFac);
                }
            });
            const format = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            document.getElementById('total-limpo').innerText = format(totalLimpo);
            document.getElementById('total-sujo').innerText = format(totalSujo);
            if(document.getElementById('edit-limpo')) {
                document.getElementById('edit-limpo').placeholder = `Atual: ${totalLimpo}`;
                document.getElementById('edit-sujo').placeholder = `Atual: ${totalSujo}`;
            }
        }

        async function salvarFinanceiroManual(tipo) {
            const val = parseFloat(document.getElementById(`edit-${tipo}`).value);
            if(isNaN(val)) return alert("Digite um valor v√°lido");
            let somaRegistros = 0;
            db.forEach(m => { if(m.valorFac && m.tipoDinheiro === tipo) somaRegistros += parseFloat(m.valorFac); });
            financeiroGlobal[tipo] = val - somaRegistros;
            await fetch(FIREBASE_FINANCE_URL, { method: 'PUT', body: JSON.stringify(financeiroGlobal) });
            alert("Financeiro Atualizado!");
            calcularFinanceiro();
        }

        function renderHistorico() {
            const container = document.getElementById('lista-recrutados');
            const data = [...db].reverse();
            container.innerHTML = data.map(r => `
                <div class="gold-card card-with-gif p-5 rounded-2xl flex justify-between items-center">
                    <div class="card-content flex items-center gap-4">
                        <img src="${r.img || GIF_CARDS}" class="w-12 h-12 rounded-lg border border-yellow-500/50 object-cover">
                        <div>
                            <p class="font-bold text-white orbitron text-sm">${r.nick}</p>
                            <p class="text-[10px] text-gray-500">ID #${r.pass} ‚Ä¢ ${r.cargo}</p>
                            <p class="text-[9px] text-gray-400">Recrutador: ${r.recrutador} ‚Ä¢ Data: ${r.data}</p>
                        </div>
                    </div>
                    <div class="card-content">
                        <button onclick='enviarComprovante(${JSON.stringify(r)})' class="bg-yellow-500/10 text-yellow-500 px-4 py-2 rounded text-[10px] font-bold">PROVA</button>
                    </div>
                </div>
            `).join('');
        }

        function renderPlanilhaData() {
            document.getElementById('titulo-planilha').innerText = "EFETIVO ESTRUTURAL - EG EGITO";
            document.getElementById('corpo-tabela').innerHTML = db.map(r => `
                <tr class="hover:bg-white/5 transition-colors">
                    <td class="p-5 font-bold text-white uppercase text-xs">${r.nick}</td>
                    <td class="p-5 text-yellow-500 font-bold">#${r.pass}</td>
                    <td class="p-5 text-xs text-gray-400">${r.cargo}</td>
                    <td class="p-5 text-xs text-gray-500">${r.recrutador}</td>
                </tr>
            `).join('');
        }

        function renderAdminData() {
            document.getElementById('corpo-tabela-admin').innerHTML = db.map(r => `
                <tr class="hover:bg-white/5 transition-colors">
                    <td class="p-5 font-bold text-white uppercase text-xs">${r.nick}</td>
                    <td class="p-5 text-yellow-500 font-bold">#${r.pass}</td>
                    <td class="p-5 text-xs text-gray-400">${r.cargo}</td>
                    <td class="p-5 text-xs text-gray-500">${r.recrutador}</td>
                    <td class="p-5 text-center">
                         <button onclick="excluirMembro('${r.firebaseId}')" class="bg-red-500 text-white px-3 py-1 rounded text-[10px] font-bold hover:bg-red-600 transition-all">REMOVER</button>
                    </td>
                </tr>
            `).join('');
        }

        function importarArquivo(input) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = async function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const json = XLSX.utils.sheet_to_json(sheet);
                if(confirm(`Deseja importar ${json.length} jogadores?`)) {
                    for(let p of json) {
                        const novo = {
                            nick: p.Nick || p.nick || "Sem Nome",
                            pass: p.Passaporte || p.pass || 0,
                            cargo: p.Cargo || p.cargo || "„Äå·¥Ñ Ä…™·¥Ä„Äç",
                            recrutador: p.Recrutador || "Sistema",
                            img: GIF_CARDS,
                            data: p.Data || new Date().toLocaleDateString('pt-BR')
                        };
                        await fetch(FIREBASE_URL, { method: 'POST', body: JSON.stringify(novo) });
                    }
                    alert("Importa√ß√£o conclu√≠da!");
                    await carregarDadosGlobais();
                    showView('dashboard');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        document.getElementById('form-recrutamento').onsubmit = async function(e) {
            e.preventDefault();
            const vTotal = parseFloat(document.getElementById('rec-valor-total').value);
            const vRecrutador = parseFloat(document.getElementById('rec-valor-recrutador').value);
            const vFac = vTotal - vRecrutador;
            const dataInput = document.getElementById('rec-data-manual').value.split('-');
            const dataFormatada = `${dataInput[2]}/${dataInput[1]}/${dataInput[0]}`;
            const novo = {
                nick: document.getElementById('rec-nick').value,
                pass: document.getElementById('rec-pass').value,
                cargo: document.getElementById('rec-cargo').value,
                img: document.getElementById('rec-img').value,
                tipoDinheiro: document.getElementById('rec-tipo-dinheiro').value,
                valorMissao: vTotal,
                valorRecrutador: vRecrutador,
                valorFac: vFac,
                recrutador: document.getElementById('rec-recrutador').value,
                data: dataFormatada
            };
            await fetch(FIREBASE_URL, { method: 'POST', body: JSON.stringify(novo) });
            alert(`Membro Registrado! Valor para Fac: R$ ${vFac.toLocaleString('pt-BR')}`);
            await carregarDadosGlobais();
            showView('dashboard');
        };

        async function excluirMembro(firebaseId) {
            if(confirm("Deseja remover este membro permanentemente?")) {
                await fetch(`https://egito-ncrp-default-rtdb.firebaseio.com/membros/${firebaseId}.json`, { method: 'DELETE' });
                await carregarDadosGlobais();
                renderAdminData();
            }
        }

        function salvarWebhooks() {
            localStorage.setItem('eg_webhook_fotos', document.getElementById('webhook-fotos').value);
            localStorage.setItem('eg_webhook_lista', document.getElementById('webhook-lista').value);
            alert("SISTEMA: Configura√ß√µes salvas!");
            showView('dashboard');
         }

        async function enviarComprovante(r) {
            const url = localStorage.getItem('eg_webhook_fotos');
            if(!url) return alert("Erro: Webhook n√£o configurado!");

            const corpoMensagem = `...`;}
` COMPROVANTE DE RECRUTAMENTO EG EGITO NCRP 
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ **${r.nick.toUpperCase()}** ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
 DADOS DO RECRUTADO
üèõÔ∏è Nick: ${r.nick}
üé´ Passaporte: #${r.pass}
üéñÔ∏è Cargo: ${r.cargo}

 FINANCEIRO DA MISS√ÉO
üí∞ Valor Total: R$ ${parseFloat(r.valorMissao || 0).toLocaleString('pt-BR')}
üë§ Comiss√£o Recrutador: R$ ${parseFloat(r.valorRecrutador || 0).toLocaleString('pt-BR')}
üè¢ Valor para Fac: R$ ${parseFloat(r.valorFac || 0).toLocaleString('pt-BR')}
üè∑Ô∏è Tipo: ${r.tipoDinheiro === 'limpo' ? 'üíµ Dinheiro Limpo' : 'üí∏ Dinheiro Sujo'}

 DADOS DO RECRUTADOR
üèõÔ∏è Nick: ${r.recrutador}
üìÖ Data: ${r.data}

 LINK DO COMPROVANTE
 [Clique aqui para ver o comprovante](${r.img})
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`;

            const embed = {
                username: "EG EGITO NCRP",
                avatar_url: GIF_CARDS,
                embeds: [{
                    description: corpoMensagem,
                    color: r.tipoDinheiro === 'limpo' ? 3066993 : 15158332,
                    image: { url: BANDEIRA_GIF },
                    thumbnail: { url: r.img },
                    footer: { 
                        text: `üî• EG Egito NCRP | Registrado por ${userLogado.nick} | üìÖ ${r.data}` 
                    }
                }]
            };

        async function enviarListaDiscord() {
            const url = localStorage.getItem('eg_webhook_lista');
            if(!url) return alert("Erro: Webhook ausente!");
            let lastMsgId = null;
            try { const resId = await fetch(FIREBASE_MSG_URL); lastMsgId = await resId.json(); } catch (e) {}
            let listaTexto = db.map(m => `> üá™üá¨ **${m.nick}** | ID: \`${m.pass}\` | ${m.cargo}`).join('\n');
            const embedData = { username: "EG EGITO NCRP", avatar_url: GIF_CARDS, embeds: [{ title: "ü¶Ö LISTA DE EFETIVO ATUALIZADA", description: `**TOTAL:** \`${db.length}\`\n\n${listaTexto}`, color: 16760868 }] };
            let endpoint = lastMsgId ? `${url}/messages/${lastMsgId}` : `${url}?wait=true`;
            let metodo = lastMsgId ? 'PATCH' : 'POST';
            try {
                const response = await fetch(endpoint, { method: metodo, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(embedData) });
                if (response.ok) {
                    if (!lastMsgId) {
                        const data = await response.json();
                        await fetch(FIREBASE_MSG_URL, { method: 'PUT', body: JSON.stringify(data.id) });
                    }
                    alert("DISCORD ATUALIZADO!");
                } else if (response.status === 404) {
                    await fetch(FIREBASE_MSG_URL, { method: 'DELETE' });
                    return enviarListaDiscord();
                }
            } catch (error) { alert("Erro de conex√£o."); }
        }

        function baixarExcel() {
            const ws = XLSX.utils.json_to_sheet(db);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "EGITO");
            XLSX.writeFile(wb, "Efetivo_Egito_Global.xlsx");
        }

        function logout() { location.reload(); }
    </script>
</body>
</html>